//@version=6
strategy("52-Week High Strategy (80/70/59)", overlay=true, margin_long=100, margin_short=100,
         default_qty_type=strategy.percent_of_equity, default_qty_value=100,
         commission_type=strategy.commission.percent, commission_value=0.1,
         slippage=1)

// ============================================================================
// STRATEGY: 52-Week High Breakout
// CONFIG: period=80, entry_pct=70%, exit_pct=59%
// SOURCE: TrendLab YOLO sweep session
// PERFORMANCE: Avg Sharpe 0.583, Hit Rate 94.1%, 51 symbols
// ============================================================================

// === INPUTS ===
int periodInput = input.int(80, "Period (lookback days)", minval=1, tooltip="Lookback period for computing rolling high")
float entryPctInput = input.float(0.70, "Entry % of high", minval=0.01, maxval=1.0, step=0.01, tooltip="Enter when close >= this % of period high")
float exitPctInput = input.float(0.59, "Exit % of high", minval=0.01, maxval=1.0, step=0.01, tooltip="Exit when close < this % of period high")

// === INDICATORS ===
float periodHigh = ta.highest(high, periodInput)
float entryThreshold = periodHigh * entryPctInput
float exitThreshold = periodHigh * exitPctInput

// === SIGNALS ===
bool entryCondition = close >= entryThreshold
bool exitCondition = close < exitThreshold

// === STRATEGY EXECUTION ===
// Long-only: enter when price is strong (near highs), exit when weakness shows
if entryCondition and strategy.position_size == 0
    strategy.entry("Long", strategy.long)

if exitCondition and strategy.position_size > 0
    strategy.close("Long")

// === PLOTTING ===
plot(periodHigh, "Period High", color=color.blue, linewidth=1)
plot(entryThreshold, "Entry Threshold (70%)", color=color.green, linewidth=1, style=plot.style_stepline)
plot(exitThreshold, "Exit Threshold (59%)", color=color.red, linewidth=1, style=plot.style_stepline)

// Background color when in position
bgcolor(strategy.position_size > 0 ? color.new(color.green, 90) : na)

// Entry/Exit markers
plotshape(entryCondition and strategy.position_size[1] == 0, "Entry", shape.triangleup, location.belowbar, color.green, size=size.small)
plotshape(exitCondition and strategy.position_size[1] > 0, "Exit", shape.triangledown, location.abovebar, color.red, size=size.small)
